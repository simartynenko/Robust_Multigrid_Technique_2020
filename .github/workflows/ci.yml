name: Fortran CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  Fortran-CI:
    name: ubuntu-20.04
    
    runs-on: ubuntu-20.04

    steps:
    - uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        sudo apt-get install gfortran

    - name: Build shared modules
      run: |
        gfortran -O3 RMT_3D_TIMES.f90 -c -o RMT_3D_TIMES.o
        gfortran -O3 RMT_3D_NFG.f90 -IRMT_Linux_x86_64 -c -o RMT_3D_NFG.o        
        gfortran -O3 RMT_3D_NFG2.f90 -IRMT_Linux_x86_64 -c -o RMT_3D_NFG2.o
        gfortran -O3 RMT_3D_UFG.f90 -IRMT_Linux_x86_64 -c -o RMT_3D_UFG.o
        
    - name: Build and run example 01
      run: |
        gfortran -O3 RMT_3D_2020_Example_01/RMT_3D_2020_Example_01.f90 -o RMT_3D_2020_Example_01/RMT_3D_2020_Example_01
        RMT_3D_2020_Example_01/RMT_3D_2020_Example_01
        
    - name: Build and run example 02
      run: |
        gfortran -O3 RMT_3D_2020_Example_02/RMT_3D_2020_Example_02_1.f90 -c -o RMT_3D_2020_Example_02_1.o
        gfortran -O3 RMT_3D_2020_Example_02/RMT_3D_2020_Example_02_2.f90 -c -o RMT_3D_2020_Example_02_2.o
        gfortran -O3 RMT_3D_2020_Example_02/RMT_3D_2020_Example_02_M.f90 RMT_3D_2020_Example_02_1.o RMT_3D_2020_Example_02_2.o RMT_3D_TIMES.o -o RMT_3D_2020_Example_02/RMT_3D_2020_Example_02_M
        RMT_3D_2020_Example_02/RMT_3D_2020_Example_02_M
        
    - name: Build and run example 03
      run: |
        gfortran -O3 RMT_3D_2020_Example_03/RMT_3D_2020_Example_03.f90 RMT_3D_UFG.o -LRMT_Linux_x86_64 -lRMT_3D_2020 -IRMT_Linux_x86_64 -o RMT_3D_2020_Example_03/RMT_3D_2020_Example_03
        RMT_3D_2020_Example_03/RMT_3D_2020_Example_03
        
    - name: Build and run example 04
      run: |
        gfortran -O3 RMT_3D_2020_Example_04/RMT_3D_2020_Example_04.f90 RMT_3D_UFG.o -LRMT_Linux_x86_64 -lRMT_3D_2020 -IRMT_Linux_x86_64 -o RMT_3D_2020_Example_04/RMT_3D_2020_Example_04
        RMT_3D_2020_Example_04/RMT_3D_2020_Example_04
        
    - name: Build and run example 05
      run: |
        gfortran -O3 RMT_3D_2020_Example_05/RMT_3D_2020_Example_05.f90 RMT_3D_UFG.o -LRMT_Linux_x86_64 -lRMT_3D_2020 -IRMT_Linux_x86_64 -o RMT_3D_2020_Example_05/RMT_3D_2020_Example_05
        RMT_3D_2020_Example_05/RMT_3D_2020_Example_05

    - name: Build and run example 06
      run: |
        gfortran -O3 RMT_3D_2020_Example_06/RMT_3D_2020_Example_06.f90 RMT_3D_UFG.o -LRMT_Linux_x86_64 -lRMT_3D_2020 -IRMT_Linux_x86_64 -o RMT_3D_2020_Example_06/RMT_3D_2020_Example_06
        RMT_3D_2020_Example_06/RMT_3D_2020_Example_06
        
    - name: Build and run example 07
      run: |
        gfortran -O3 RMT_3D_2020_Example_07/RMT_3D_2020_Example_07.f90 RMT_3D_NFG.o -LRMT_Linux_x86_64 -lRMT_3D_2020 -IRMT_Linux_x86_64 -o RMT_3D_2020_Example_07/RMT_3D_2020_Example_07
        RMT_3D_2020_Example_07/RMT_3D_2020_Example_07
        
    - name: Build and run example 08
      run: |
        gfortran -O3 RMT_3D_2020_Example_08/RMT_3D_2020_Example_08.f90 RMT_3D_NFG2.o -LRMT_Linux_x86_64 -lRMT_3D_2020 -IRMT_Linux_x86_64 -o RMT_3D_2020_Example_08/RMT_3D_2020_Example_08
        RMT_3D_2020_Example_08/RMT_3D_2020_Example_08

    - name: Build and run example 09
      run: |
        gfortran -O3 RMT_3D_2020_Example_09/RMT_3D_2020_Example_09_1.f90 -c -o RMT_3D_2020_Example_09_1.o
        gfortran -O3 RMT_3D_2020_Example_09/RMT_3D_2020_Example_09_2.f90 -IRMT_Linux_x86_64 -c -o RMT_3D_2020_Example_09_2.o
        gfortran -O3 RMT_3D_2020_Example_09/RMT_3D_2020_Example_09_M.f90 RMT_3D_2020_Example_09_1.o RMT_3D_2020_Example_09_2.o RMT_3D_UFG.o -LRMT_Linux_x86_64 -lRMT_3D_2020 -IRMT_Linux_x86_64 -o RMT_3D_2020_Example_09/RMT_3D_2020_Example_09_M
        RMT_3D_2020_Example_09/RMT_3D_2020_Example_09_M
        head -n 20 RMT_3D_2020_Example_09.res
